{"datasets":[{"name":"cce766e9","displayName":"daily_job_count","query":"SELECT\n  workspace_id,\n  run_type,\n  trigger_type,\n  result_state,\n  COUNT(DISTINCT run_id) as job_count,\n  date_trunc(:date_grain_param, to_date(period_start_time)) as date_grain\nFROM system.lakeflow.job_run_timeline\nWHERE\n  period_start_time > CURRENT_TIMESTAMP() - INTERVAL 365 DAYS\nGROUP BY ALL\n","parameters":[{"displayName":"date_grain_param","keyword":"date_grain_param","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"week"}]}}}]},{"name":"0546213d","displayName":"daily_job_status","query":"SELECT\n  workspace_id,\n  COUNT(DISTINCT run_id) as job_count,\n  result_state,\n  date_trunc(:date_grain_param, to_date(period_start_time)) as date_grain\nFROM system.lakeflow.job_run_timeline\nWHERE\n  period_start_time > CURRENT_TIMESTAMP() - INTERVAL 365 DAYS\n  AND result_state IS NOT NULL\nGROUP BY ALL\n","parameters":[{"displayName":"date_grain_param","keyword":"date_grain_param","dataType":"STRING","defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"week"}]}}}]},{"name":"fcdaaabb","displayName":"longest_running_jobs","query":"with job_run_duration as (\n    SELECT\n        workspace_id,\n        job_id,\n        run_id,\n        CAST(SUM(period_end_time - period_start_time) AS LONG) as duration\n    FROM\n        system.lakeflow.job_run_timeline\n    WHERE\n      period_start_time > CURRENT_TIMESTAMP() - INTERVAL 365 DAYS\n    GROUP BY ALL\n),\nmost_recent_jobs as (\n  SELECT\n    *,\n    ROW_NUMBER() OVER(PARTITION BY workspace_id, job_id ORDER BY change_time DESC) as rn\n  FROM\n    system.lakeflow.jobs QUALIFY rn=1\n)\nSELECT\n    t1.workspace_id,\n    t1.job_id,\n    first(t2.name, TRUE) as name,\n    COUNT(DISTINCT t1.run_id) as runs,\n    MEAN(t1.duration) as mean_seconds,\n    AVG(t1.duration) as avg_seconds,\n    PERCENTILE(t1.duration, 0.9) as p90_seconds,\n    PERCENTILE(t1.duration, 0.95) as p95_seconds\nFROM\n    job_run_duration t1\n    LEFT OUTER JOIN most_recent_jobs t2 USING (workspace_id, job_id)\nGROUP BY ALL\nORDER BY mean_seconds DESC\nLIMIT 10\n"},{"name":"d1628e7f","displayName":"all_purpose_compute_jobs","query":"with clusters AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER(PARTITION BY workspace_id, cluster_id ORDER BY change_time DESC) as rn\n  FROM system.compute.clusters\n  WHERE cluster_source=\"UI\" OR cluster_source=\"API\"\n  QUALIFY rn=1\n),\njob_tasks_exploded AS (\n  SELECT\n    workspace_id,\n    job_id,\n    EXPLODE(compute_ids) as cluster_id\n  FROM system.lakeflow.job_task_run_timeline\n  WHERE period_start_time >= CURRENT_DATE() - INTERVAL 365 DAY\n),\nall_purpose_cluster_jobs AS (\n  SELECT\n    t1.*,\n    t2.cluster_name,\n    t2.owned_by,\n    t2.dbr_version\n  FROM job_tasks_exploded t1\n    INNER JOIN clusters t2 USING (workspace_id, cluster_id)\n)\nSELECT * FROM all_purpose_cluster_jobs LIMIT 10;\n"},{"name":"0cd82b91","displayName":"date_grain_choices","query":"SELECT\n  *\nFROM\n  (\n    VALUES\n      ('day'),\n      ('week'),\n      ('month')\n  ) AS data (available_date_grains)"},{"name":"5737f2a0","displayName":"job_spend","query":"with jobs_usage_with_list_cost as (\n  SELECT\n    t1.*,\n    t1.usage_quantity * list_prices.pricing.default as list_cost\n  FROM system.billing.usage t1 \n  INNER JOIN system.billing.list_prices list_prices on\n      t1.cloud = list_prices.cloud and\n      t1.sku_name = list_prices.sku_name and\n      t1.usage_start_time >= list_prices.price_start_time and\n      (t1.usage_end_time <= list_prices.price_end_time or list_prices.price_end_time is null)\n  WHERE\n    t1.sku_name LIKE '%JOBS%'\n)\nSELECT\n    *\n    ,try_divide( (last30DaySpend - last30to60DaySpend) , last30to60DaySpend) * 100 AS Last30DayGrowth\nFROM\n  (\n    SELECT\n      SUM(list_cost) AS spend\n      ,sku_name\n      ,SUM(CASE WHEN usage_end_time BETWEEN date_add(current_date(), -30) AND current_date() THEN list_cost ELSE 0 END) AS Last30DaySpend\n      ,SUM(CASE WHEN usage_end_time BETWEEN date_add(current_date(), -60) AND date_add(current_date(), -31) THEN list_cost ELSE 0 END) AS Last30to60DaySpend\n    FROM jobs_usage_with_list_cost\n    GROUP BY ALL\n  )"}],"pages":[{"name":"307792bd","displayName":"New Page","layout":[{"widget":{"name":"982e28fb","queries":[{"name":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a5a311588a6c0907e2c704a4_workspace_id","query":{"datasetName":"cce766e9","fields":[{"name":"workspace_id","expression":"`workspace_id`"},{"name":"workspace_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}},{"name":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a9bd1d5fb5b5146f18a1521f_workspace_id","query":{"datasetName":"0546213d","fields":[{"name":"workspace_id","expression":"`workspace_id`"},{"name":"workspace_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}},{"name":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12adbd1560b3aca87be3246db2_workspace_id","query":{"datasetName":"fcdaaabb","fields":[{"name":"workspace_id","expression":"`workspace_id`"},{"name":"workspace_id_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-multi-select","encodings":{"fields":[{"fieldName":"workspace_id","displayName":"workspace_id","queryName":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a5a311588a6c0907e2c704a4_workspace_id"},{"fieldName":"workspace_id","displayName":"workspace_id","queryName":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a9bd1d5fb5b5146f18a1521f_workspace_id"},{"fieldName":"workspace_id","displayName":"workspace_id","queryName":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12adbd1560b3aca87be3246db2_workspace_id"}]},"frame":{"showTitle":true,"title":"Workspace ID"}}},"position":{"x":3,"y":2,"width":3,"height":1}},{"widget":{"name":"6322b6cb","queries":[{"name":"main_query","query":{"datasetName":"cce766e9","fields":[{"name":"trigger_type","expression":"`trigger_type`"},{"name":"daily(date_grain)","expression":"DATE_TRUNC(\"DAY\", `date_grain`)"},{"name":"sum(job_count)","expression":"SUM(`job_count`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(date_grain)","scale":{"type":"categorical"},"displayName":"Time Period"},"y":{"fieldName":"sum(job_count)","scale":{"type":"quantitative"},"displayName":"Job Count"},"color":{"fieldName":"trigger_type","scale":{"type":"categorical"},"displayName":"trigger_type"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Job Count by Trigger Type"}}},"position":{"x":0,"y":3,"width":3,"height":6}},{"widget":{"name":"130291b3","queries":[{"name":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef833dbf6c1db2a4d3a4001688111e_available_date_grains","query":{"datasetName":"0cd82b91","fields":[{"name":"available_date_grains","expression":"`available_date_grains`"},{"name":"available_date_grains_associativity","expression":"COUNT_IF(`associative_filter_predicate_group`)"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a5a311588a6c0907e2c704a4_date_grain_param","query":{"datasetName":"cce766e9","parameters":[{"name":"date_grain_param","keyword":"date_grain_param"}],"disaggregated":false}},{"name":"parameter_dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a9bd1d5fb5b5146f18a1521f_date_grain_param","query":{"datasetName":"0546213d","parameters":[{"name":"date_grain_param","keyword":"date_grain_param"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"filter-single-select","encodings":{"fields":[{"fieldName":"available_date_grains","displayName":"available_date_grains","queryName":"dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef833dbf6c1db2a4d3a4001688111e_available_date_grains"},{"parameterName":"date_grain_param","queryName":"parameter_dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a5a311588a6c0907e2c704a4_date_grain_param"},{"parameterName":"date_grain_param","queryName":"parameter_dashboards/01ef7a12a29814caa0e7e84120e928b8/datasets/01ef7a12a9bd1d5fb5b5146f18a1521f_date_grain_param"}]},"selection":{"defaultSelection":{"values":{"dataType":"STRING","values":[{"value":"day"}]}}},"frame":{"showTitle":true,"title":"Date Grain Parameter"}}},"position":{"x":0,"y":2,"width":3,"height":1}},{"widget":{"name":"0b6fc06c","queries":[{"name":"main_query","query":{"datasetName":"cce766e9","fields":[{"name":"result_state","expression":"`result_state`"},{"name":"daily(date_grain)","expression":"DATE_TRUNC(\"DAY\", `date_grain`)"},{"name":"sum(job_count)","expression":"SUM(`job_count`)"}],"disaggregated":false}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"daily(date_grain)","scale":{"type":"categorical"},"displayName":"Time Period"},"y":{"fieldName":"sum(job_count)","scale":{"type":"quantitative"},"displayName":"Job Count"},"color":{"fieldName":"result_state","scale":{"type":"categorical"},"displayName":"result_state"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Job Count by Result State"}}},"position":{"x":3,"y":3,"width":3,"height":6}},{"widget":{"name":"06da98e0","queries":[{"name":"main_query","query":{"datasetName":"fcdaaabb","fields":[{"name":"job_id","expression":"`job_id`"},{"name":"workspace_id","expression":"`workspace_id`"},{"name":"avg_seconds","expression":"`avg_seconds`"}],"disaggregated":true}}],"spec":{"version":3,"widgetType":"bar","encodings":{"x":{"fieldName":"workspace_id","scale":{"type":"categorical"},"displayName":"workspace_id"},"y":{"fieldName":"avg_seconds","scale":{"type":"quantitative"},"displayName":"avg_seconds"},"color":{"fieldName":"job_id","scale":{"type":"categorical"},"displayName":"job_id"},"label":{"show":true}},"frame":{"showTitle":true,"title":"Top 10 Longest Running Jobs by Workspace"}}},"position":{"x":0,"y":9,"width":3,"height":6}},{"widget":{"name":"6f690bac","queries":[{"name":"main_query","query":{"datasetName":"fcdaaabb","fields":[{"name":"job_id","expression":"`job_id`"},{"name":"runs","expression":"`runs`"},{"name":"mean_seconds","expression":"`mean_seconds`"},{"name":"avg_seconds","expression":"`avg_seconds`"},{"name":"p90_seconds","expression":"`p90_seconds`"},{"name":"p95_seconds","expression":"`p95_seconds`"}],"disaggregated":true}}],"spec":{"version":1,"widgetType":"table","encodings":{"columns":[{"fieldName":"job_id","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"string","displayAs":"string","visible":true,"order":100001,"title":"job_id","allowSearch":false,"alignContent":"left","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"job_id"},{"fieldName":"runs","numberFormat":"0","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"integer","displayAs":"number","visible":true,"order":100003,"title":"runs","allowSearch":false,"alignContent":"right","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"runs"},{"fieldName":"mean_seconds","numberFormat":"0.00","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"float","displayAs":"number","visible":true,"order":100004,"title":"mean_seconds","allowSearch":false,"alignContent":"right","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"mean_seconds"},{"fieldName":"avg_seconds","numberFormat":"0.00","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"float","displayAs":"number","visible":true,"order":100005,"title":"avg_seconds","allowSearch":false,"alignContent":"right","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"avg_seconds"},{"fieldName":"p90_seconds","numberFormat":"0.00","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"float","displayAs":"number","visible":true,"order":100006,"title":"p90_seconds","allowSearch":false,"alignContent":"right","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"p90_seconds"},{"fieldName":"p95_seconds","numberFormat":"0.00","booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"type":"float","displayAs":"number","visible":true,"order":100007,"title":"p95_seconds","allowSearch":false,"alignContent":"right","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false,"displayName":"p95_seconds"}]},"invisibleColumns":[{"booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"name":"workspace_id","type":"string","displayAs":"string","order":100000,"title":"workspace_id","allowSearch":false,"alignContent":"left","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false},{"booleanValues":["false","true"],"imageUrlTemplate":"{{ @ }}","imageTitleTemplate":"{{ @ }}","imageWidth":"","imageHeight":"","linkUrlTemplate":"{{ @ }}","linkTextTemplate":"{{ @ }}","linkTitleTemplate":"{{ @ }}","linkOpenInNewTab":true,"name":"name","type":"string","displayAs":"string","order":100002,"title":"name","allowSearch":false,"alignContent":"left","allowHTML":false,"highlightLinks":false,"useMonospaceFont":false,"preserveWhitespace":false}],"allowHTMLByDefault":false,"itemsPerPage":25,"paginationSize":"default","condensed":true,"withRowNumber":true,"frame":{"showTitle":true,"title":"Job Details"}}},"position":{"x":3,"y":9,"width":3,"height":6}},{"widget":{"name":"6e8f847c","queries":[{"name":"main_query","query":{"datasetName":"5737f2a0","fields":[{"name":"sum(Last30DaySpend)","expression":"SUM(`Last30DaySpend`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(Last30DaySpend)","format":{"type":"number-currency","currencyCode":"USD","abbreviation":"compact","decimalPlaces":{"type":"max","places":2}},"displayName":"Sum of Last30DaySpend"}},"frame":{"showTitle":true,"title":"30 Day List Spend"}}},"position":{"x":0,"y":0,"width":3,"height":2}},{"widget":{"name":"bd6fc6d6","queries":[{"name":"main_query","query":{"datasetName":"5737f2a0","fields":[{"name":"sum(Last30to60DaySpend)","expression":"SUM(`Last30to60DaySpend`)"}],"disaggregated":false}}],"spec":{"version":2,"widgetType":"counter","encodings":{"value":{"fieldName":"sum(Last30to60DaySpend)","format":{"type":"number-currency","currencyCode":"USD","abbreviation":"compact","decimalPlaces":{"type":"max","places":2}},"displayName":"Sum of Last30to60DaySpend"}},"frame":{"showTitle":true,"title":"30-60 Day List Spend"}}},"position":{"x":3,"y":0,"width":3,"height":2}}]}]}